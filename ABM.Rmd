---
title: "ABM"
author: "Astrid Elmann Hansen"
date: '2022-06-11'
output: html_document
---

```{r}
pacman::p_load(tidyverse)
source("functions/dates.R")
source("functions/generate_matrix.R")
source("functions/matrix_choice.R")
source("functions/get_box.R")
```

```{r}

ka <- 2
kp <- 2

N <- 2 # number of agents

initial_dep <- 0.1 # the dependence value all dyads start with
initial_sat <- 0.1 # the satisfaction value all dyads start with

sat <- sample(-10:10, N^2, replace = TRUE) # for testing
dep <- sample(-10:10, N^2, replace = TRUE) # for testing
dep[dep==0] <- 0.1 # lololol

dyads <- tibble(agent_1 = as.numeric(rep(1:N, each=N)), # create df with dyads and inital values
                agent_2 = as.numeric(rep(seq(1:N),N)),
                sat = sat,
                dep = dep)
                #sat = as.numeric(rep(initial_sat,N^2)),
                #dep = as.numeric(rep(initial_dep,N^2)))
  
dyads <- dyads %>% filter(agent_1 != agent_2) # Remove dyads with the same agent twice

sort <- "sat"
```


```{r}
line <- c(1,2,1,2,1,1,2,2)
agent <- c("A","A","A","A","B","B","B","B")
box <- c(1,2,3,4,1,2,3,4)

empty_matrix <- tibble( line = line,
                        agent = agent,
                        box = box,
                        outcome = as.numeric(rep(0,8)))
```

```{r}
ptm <- proc.time() # start a stopwatch
dates <- dates(N = N, dyads = dyads, sort = sort)
proc.time() - ptm # get stopwatch time
```
```{r}
# i <- 1
# A = dates$A[i]
# B = dates$B[i]
# matrix = empty_matrix

#@ remove line from empty matrix

for (i in 1:nrow(dates)){ # for every dyad
  
  m <- generate.matrix(A = dates$A[i], B = dates$B[i], matrix = empty_matrix, dyads = dyads, ka = ka, kp = kp) # generate matrix
  
  A_choice <- own.max(agent = "A", matrix = m) # each agent chooses
  B_choice <- own.max(agent = "B", matrix = m)
  
  box <- get.box(A_choice = A_choice, B_choice = B_choice) # find chosen box

}
```


